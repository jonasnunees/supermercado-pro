<!DOCTYPE html>
<!-- Declaraﾃｧﾃ｣o do tipo de documento HTML5 -->
<html lang="pt-br">
<!-- Inﾃｭcio do documento HTML com idioma definido como portuguﾃｪs brasileiro -->

<head>
    <!-- Seﾃｧﾃ｣o HEAD contﾃｩm metadados e links para arquivos externos -->
    
    <!-- Define a codificaﾃｧﾃ｣o de caracteres para UTF-8 (suporta acentuaﾃｧﾃ｣o) -->
    <meta charset="UTF-8">
    
    <!-- Configura a visualizaﾃｧﾃ｣o responsiva em dispositivos mﾃｳveis -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Tﾃｭtulo que aparece na aba do navegador -->
    <title>Supermercado Pro - Login</title>
    
    <!-- Link para o arquivo de estilos CSS externo -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Importa a biblioteca Supabase direto do CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <!-- Container principal centralizado -->
    <div class="container" style="margin-top: 50px;">
        <!-- Logo ou ﾃｭcone do aplicativo -->
        <div style="text-align: center; font-size: 4rem; margin-bottom: 1rem;">
            將
        </div>
        
        <!-- Tﾃｭtulo da pﾃ｡gina de login -->
        <h2>Supermercado Pro</h2>
        
        <!-- Subtﾃｭtulo -->
        <p style="text-align: center; color: var(--gray); margin-bottom: 2rem;">
            Controle suas compras de forma inteligente
        </p>

        <!-- Formulﾃ｡rio de Login -->
        <div id="login-form" class="auth-form">
            <h3>Entrar na sua conta</h3>
            
            <!-- Campo de email -->
            <div class="input-group">
                <label for="login-email">E-mail:</label>
                <input type="email" id="login-email" placeholder="seu@email.com" required>
            </div>
            
            <!-- Campo de senha -->
            <div class="input-group">
                <label for="login-password">Senha:</label>
                <input type="password" id="login-password" placeholder="窶｢窶｢窶｢窶｢窶｢窶｢窶｢窶｢" required>
            </div>
            
            <!-- Botﾃ｣o de login -->
            <button class="btn-add" onclick="handleLogin()">Entrar</button>
            
            <!-- Link para trocar para cadastro -->
            <p style="text-align: center; margin-top: 1rem; color: var(--gray);">
                Nﾃ｣o tem uma conta? 
                <a href="#" onclick="toggleForms(); return false;" style="color: var(--primary); font-weight: bold;">
                    Cadastre-se
                </a>
            </p>
        </div>

        <!-- Formulﾃ｡rio de Cadastro (inicialmente oculto) -->
        <div id="signup-form" class="auth-form" style="display: none;">
            <h3>Criar nova conta</h3>
            
            <!-- Campo de nome -->
            <div class="input-group">
                <label for="signup-name">Nome completo:</label>
                <input type="text" id="signup-name" placeholder="Seu nome" required>
            </div>
            
            <!-- Campo de email -->
            <div class="input-group">
                <label for="signup-email">E-mail:</label>
                <input type="email" id="signup-email" placeholder="seu@email.com" required>
            </div>
            
            <!-- Campo de senha -->
            <div class="input-group">
                <label for="signup-password">Senha:</label>
                <input type="password" id="signup-password" placeholder="Mﾃｭnimo 6 caracteres" required>
            </div>
            
            <!-- Campo de confirmaﾃｧﾃ｣o de senha -->
            <div class="input-group">
                <label for="signup-confirm">Confirmar senha:</label>
                <input type="password" id="signup-confirm" placeholder="Digite a senha novamente" required>
            </div>
            
            <!-- Botﾃ｣o de cadastro -->
            <button class="btn-add" onclick="handleSignup()">Criar conta</button>
            
            <!-- Link para trocar para login -->
            <p style="text-align: center; margin-top: 1rem; color: var(--gray);">
                Jﾃ｡ tem uma conta? 
                <a href="#" onclick="toggleForms(); return false;" style="color: var(--primary); font-weight: bold;">
                    Faﾃｧa login
                </a>
            </p>
        </div>

        <!-- ﾃ〉ea de loading (aparece durante autenticaﾃｧﾃ｣o) -->
        <div id="loading" style="display: none; text-align: center; padding: 2rem;">
            <div style="font-size: 2rem;">竢ｳ</div>
            <p style="color: var(--gray);">Aguarde...</p>
        </div>
    </div>

    <!-- Elemento de notificaﾃｧﾃ｣o (toast) -->
    <div id="notification"></div>

    <!-- Script de autenticaﾃｧﾃ｣o -->
    <script>
        // ========================================
        // CONFIGURAﾃﾃグ DO SUPABASE
        // Substitua pelas suas credenciais reais
        // ========================================

        // URL do seu projeto Supabase
        const SUPABASE_URL = 'https://vkgqxwcxnzuqjsgfzuau.supabase.co'; // Ex: https://xxxx.supabase.co

        // Chave pﾃｺblica (anon key) do Supabase
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZrZ3F4d2N4bnp1cWpzZ2Z6dWF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3MDg3MDAsImV4cCI6MjA4MjI4NDcwMH0.vJnHuo9ORGBSgDPh6TlV8gBR6XjCzY6RYIe_zNjZ5I8';

        // Cria a instﾃ｢ncia do cliente Supabase
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ========================================
        // FUNﾃﾃグ PARA ALTERNAR ENTRE LOGIN E CADASTRO
        // ========================================
        function toggleForms() {
            // Seleciona os dois formulﾃ｡rios
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            
            // Se o login estﾃ｡ visﾃｭvel, mostra o cadastro e vice-versa
            if (loginForm.style.display !== 'none') {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            } else {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            }
        }

        // ========================================
        // FUNﾃﾃグ PARA MOSTRAR NOTIFICAﾃﾃ髭S
        // ========================================
        function showNotification(text, color) {
            // Seleciona o elemento de notificaﾃｧﾃ｣o
            const note = document.getElementById('notification');
            
            // Define o texto e cor
            note.innerText = text;
            note.style.backgroundColor = color;
            note.style.display = 'block';
            
            // Esconde apﾃｳs 3 segundos
            setTimeout(() => note.style.display = 'none', 3000);
        }

        // ========================================
        // FUNﾃﾃグ PARA MOSTRAR/ESCONDER LOADING
        // ========================================
        function showLoading(show) {
            // Seleciona todos os elementos
            const loading = document.getElementById('loading');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            
            if (show) {
                // Mostra loading e esconde formulﾃ｡rios
                loading.style.display = 'block';
                loginForm.style.display = 'none';
                signupForm.style.display = 'none';
            } else {
                // Esconde loading e mostra o formulﾃ｡rio de login
                loading.style.display = 'none';
                loginForm.style.display = 'block';
            }
        }

        // ========================================
        // FUNﾃﾃグ PARA FAZER LOGIN
        // ========================================
        async function handleLogin() {
            // Pega os valores dos campos
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            // Validaﾃｧﾃ｣o bﾃ｡sica
            if (!email || !password) {
                showNotification('Preencha todos os campos!', '#ef4444');
                return;
            }
            
            // Mostra loading
            showLoading(true);
            
            try {
                // Tenta fazer login no Supabase
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                // Se houver erro, exibe mensagem
                if (error) throw error;
                
                // Login bem-sucedido
                showNotification('Login realizado com sucesso!', '#16a34a');
                
                // Aguarda 1 segundo e redireciona para a pﾃ｡gina principal
                setTimeout(() => {
                    window.location.href = 'app.html';
                }, 1000);
                
            } catch (error) {
                // Exibe erro
                console.error('Erro no login:', error);
                showNotification('Email ou senha incorretos!', '#ef4444');
                showLoading(false);
            }
        }

        // ========================================
        // FUNﾃﾃグ PARA FAZER CADASTRO
        // ========================================
        async function handleSignup() {
            // Pega os valores dos campos
            const name = document.getElementById('signup-name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm').value;
            
            // Validaﾃｧﾃｵes
            if (!name || !email || !password || !confirm) {
                showNotification('Preencha todos os campos!', '#ef4444');
                return;
            }
            
            if (password.length < 6) {
                showNotification('A senha deve ter no mﾃｭnimo 6 caracteres!', '#ef4444');
                return;
            }
            
            if (password !== confirm) {
                showNotification('As senhas nﾃ｣o coincidem!', '#ef4444');
                return;
            }
            
            // Mostra loading
            showLoading(true);
            
            try {
                // Cria a conta no Supabase
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: name
                        }
                    }
                });
                
                // Se houver erro, exibe mensagem
                if (error) throw error;
                
                // Cadastro bem-sucedido
                showNotification('Conta criada com sucesso! Faﾃｧa login.', '#16a34a');
                
                // Aguarda 2 segundos e volta para o login
                setTimeout(() => {
                    showLoading(false);
                    toggleForms();
                    
                    // Limpa os campos
                    document.getElementById('signup-name').value = '';
                    document.getElementById('signup-email').value = '';
                    document.getElementById('signup-password').value = '';
                    document.getElementById('signup-confirm').value = '';
                }, 2000);
                
            } catch (error) {
                // Exibe erro
                console.error('Erro no cadastro:', error);
                showNotification(error.message || 'Erro ao criar conta!', '#ef4444');
                showLoading(false);
            }
        }

        // ========================================
        // PERMITE LOGIN COM ENTER
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            // No formulﾃ｡rio de login
            const loginInputs = document.querySelectorAll('#login-form input');
            loginInputs.forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleLogin();
                });
            });
            
            // No formulﾃ｡rio de cadastro
            const signupInputs = document.querySelectorAll('#signup-form input');
            signupInputs.forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleSignup();
                });
            });
        });
    </script>
</body>
</html>